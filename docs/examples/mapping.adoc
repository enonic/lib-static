= XP controller mapping

Using <<path#example-getcleanpath, .getCleanPath>>, lib-static can be used to serve assets from link:https://developer.enonic.com/docs/xp/stable/cms/mappings[mapped controllers].

This example uses regular expressions to support the `.getCleanPath` <<path#example-gotchas, criteria>>, and will serve assets (including index fallbacks) from the root _my/folder_ on the endpoint `<siteUrl>/static`:

.src/main/resources/site/site.xml:
[source,xml,options="nowrap"]
----
<mapping controller="/controllers/static.js" order="50">
    <pattern>/static(/.*)?$</pattern>
</mapping>
----

.src/main/resources/controllers/static.js:
[source,javascript,options="nowrap"]
----
const getStatic = libStatic.buildGetter({
        root: `my/folder`,
        getCleanPath: request => {
            const basePath = `${libPortal.getSite()._path}/static`;
            const pattern = new RegExp(`${basePath}(/.*)?$`);
            const matched = (request.rawPath || '').match(pattern);

            if (!matched) {
                throw Error(`basePath ($basePath}) was not found in request.rawPath (${request.rawPath}`);
            }

            return matched[1] || '';
        },
    });

exports.get = request => getStatic(request);
----
